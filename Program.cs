var fullInput =
@"FFFFVVVVCCCUUUUUUUUUUUUUUTUFFFFEEEEEEEXXBBBBBBBBBBBBBBEEEEEEEEEEEEECCCCCCCCCCCCCCCQQUUUZZZZZZZZZUZZZQUUUUUUIIIIIIIIDQQQQQQQQQNNNNNNNNNNNNNNN
FFFVVVVVVVVUUUUUUUUUUUUUUUUFFFFEEEEEEEXXXBBBBBBBBEEEEEEEEEEEEEEEECCCCCCCCCCCCCCCCCQQUUZZZZZZZZZZZZZZUUUUUUUIIFFFOIDDDDQQQQQQNNNNNNNNNNNNNNNN
FFFVVVVVVVVUUXUUUUUUUUUUUUUFXEEEEEEEEEXXXBBBBBBBBEEEEEEEEEEEEEEEECCCCCCCCCCCCCCCCQQQZZZZZZZZZZZZZZZZAUUUUUUOIFFFOIIDDDQQQQQQQQNNNNNNNNNNNNNN
FFFVVVVVVFFFUXUUUUUUUXUUXQXXXXXEEEEEEXXFFBBBBBBBBBBEEEEEEEEEEEEEEECCCCCCCCCCCQQCCQQQZZZZZZZZZZZZZZGZAAUUUUOOOOOOODDDDDDDDDDQQQQNNNNNNNNNNNNN
FVVVVVVVVVVFUUUUUUUXXXXXXXXXXRRXEEECEXXBBBBBBBBBBBBHEEEEEEEEEEEEECCCCCCCCCCCCCQQQQQQZZZCZZZZDDZGZZGAAAUUUUOOOOOOOOOFFDDDDDDDDQDNNNNNNNNNNNNN
FVVVVVVVVVVFUUFFUUUUXXXXXXXXXXXXEEVEEXXBBBBBBBBBBBHHHEEEEEEEEEEEECCCCCOCCCCQQQQQQQQQQZZZZZZZZZGGGZGAAAAUUUDDOOOOOOOODDDDDDDDDDDBBBNNNNNNNNNN
FFFVVVVVVVVFFUFFUUUUXXXXXXXXXXXXXEEEEXXBBBBBBBBBBBHHHHHEZZEEWWWEECECCCOOCCCCQQQQQQQQQQQZQZZZZZGGGGGAAAAUUUUOOOOOOOOODDDDDDDDDDBBBBNNNNNFFFNN
FFFFFFVVZVVFFFFFUUUUUUUXXXXXXXXXXXEXXXXXXBBBBBBBHHHHHFFJZZEWWWWWEEECCCOOCOOQQQQQQQQQQQQQQQZZZZGGGAAAAAKKKUKOOOOOOOOOODDDDDDDDBBBBBNNNFFWFFFF
CCCCFFFVVVVVFFAFUUUUUQXXXXXXXXXXXXEXXXXXXXBBBBBBBHHHHFCJJJWWEWWWWECCOOOOOOOQQQQQQQQQQQQQQQQQQZGGKAAAAKKKKKKOOOOOOOOOOOODDDDDBBBBBBBNNFFFFFFF
CCCRCCFVVFFFFFAFAUUZZQQXXXXXXXXXXXEENXXXXXXXBYYYYYYYFFCJJJJWWWWWWWWCOOOOOOOUUQQQQQQQQQQQQQQQQQQKKKKKKKKKKKKOOOOOOOOOOODDDDDDBBBBBBBNBFFFFFFF
CCCCCCFFFFFFAAAAAAZZZZXXXXXXXXEEEEEENNVVXXXNNYYYYYYYFFCCJJJWWWWWWWWOOOOOOOOUQQQQQQQQXXXQQQQQQQQPKKKKKKKKKKKOLOOOOOOOOODDDDDDDDBBBBBBBFFFFFFF
CCCCCCCFFFAAAAAAAZZZZZXXXXXXXXXEEEEVNNVVQQQNNYYYYYYYFFCCCWWWWWWWWWWJOOOOOOOOOQQQQQXXXXMQQQQQLQBPPKKKKKKKKKKKOOOOOOOODDDDDDDDDDDBBBBEBFFFFFFF
CCCCCHBBBFFFAAAAAAZZZXXXXXXXXXXEEEEVVVVVQNNNNYYYYYYYFFFCWWWWWWWWWWOOOOOOOOOOOOQQQQQXXXXQQQQEPPBPPPKKKKKKKKKOOOOOOJOOXDDDDDDDDDBBBBBBBBBFFFFF
BCBCCBBBBFFFAAAAAAAZZXZSXXXNXXEEEVEVAVVVNNNNNYYYYYYYFFFFFNNWFWWWWWPOOOOOOOOOOOZQQQZXXXXXPQLPPPBPPKKKKKKKKKKKKOOOOJJJXXDDDDDDDDGBBBBBBBBFFFFF
BBBBBBBBZZZZAAAABBBZZZZZZYNNNEEEVVVVVVVVVVYYYYYYYYYYFFFFNNWWWWWURWPOOOOOOOOAOOZQQQZXXXXXPPPPPPPPPUPKKKKKKKKKKPOJJJJJJXXDDDDDDDBBBBBBBBFFFFFF
BBBBBBBZZZZZZAABBBBZZZZZZNNNNEVVVVVVVVVVVVYYYYYYYYYYFFFFNNWNWWYUUAOOOOOOOOOOOJJJQHXXXXXXPPPPPPPPPPPPKKKKKKPPPPPDJJJXXXDDDDDDDGBBBBBBFFFFFFFF
BBBBBBBZZZZZZAAAZBBBZZBBBBNNNVVVVVVVVVVVVVYYYYYYYYYYMFNNNNNNWWUUUUOOOOOOOOOOOJJJHHXXXXXPPPPPPPPPPPPPKKKKPPPPPPPDJJJJXXXXDDDDDXXXBFFFFFFFFFFF
BBBBBBBFFFZZZZZZZBBBZBBBBBNNNNVVVVVVVVVVVVYYYYYYYYYYANNNNUUNUUUUUUOOOOOOOOOOJJJJJHXXXXXZPPPPPPPPPPPPPKJPYPPPPPPPJJXXXXXXDXDDXXXXKUUFFFFFFFFF
BBBBBBFFZFZZZZZZZBBBBBBBBNNNNNVVVVVVVVVVVVYYYYYYYYYYANNNUUUUUUUUUUOOOOOOOOOOJJJJJXXXXXXZPPPPPPPPPPPPPKJPPPPPPPPPJJXXXXXXXXXDXXXXXUUFFFFFFFFF
BBBBBFFZZZZZZZZZZBBBBBBBBNNNNNNNVVVVVVVVVYYYYYYYYYYAANNNNNUUUUUUUOOCOOOOOJJJJJJJJXXXXXXXCPPPPPPPPPPPPKJJPJPPPPPPXJXXXXXXXXXXXXXXXUUUUFFFFFFF
BBBBBFFZZZZZZZZZZBBBBBBBBNNNNNNNNVVVVPVVVYYYYYYYYYYYYYYNNNUUUUUUUCCCUUUUOJJJJJJJJJXXXXXXXPPPPPPPPPPPPJJJJJPPPPXXXXXXXXXXXXXVXXXXUUUUUUUUUFFF
BBBBFFFZZZZZZZZZBBBBBBDDDNNNNNNNNNVVVVVVVYYYYYYYYYYYYYYNNIUUUUUUCCCCUUUUOOOOOJJJJJXXXXXXXPPPPPPPPPPPPJDDDPPPPCXXXXCXXXXXXXVVVVUUUUUUUUUUUUFF
VBBBBBFFZZZZZZZZZZBFFBDDDDDNNNNNNNVVVVVVVYYYYYYYYYYYYYYANIIUUUUUUUUUUIIIOOOOOJJJJXXXJKXXQPPPPPPPPPPPJJDYDDPPPPPDDCCCXXXXXXVVVVSUUUUUUUUUUUFF
VBBBBFFFZZZZZZZZZZBFFBBBDDDDNNNNNNNNNNNVWYYYYYYYYYYYYYYANIIIIIUUUUUUUUIIOOOOOJJJJJJJJJUXQQPPPPPPPPEEDJDDDDPPDPPDNCCCXXXXXVVVVGUUUUUUUUUUUUFF
BBBBFFFFFZZZZZZZZZZFFFFBDDDDNNNNNNNNNNNNXYYYYYYYYYYYYYYANIIIIIIUUUUUUIIIOOOOOIJJJJJHJUUUPPPPPURRPAAADDDDPPPDDDDDDCCCCXXXXVVVVUUUUUUUUEUGGGFF
BBBFFFFFFZFZZZZZFZFFFFFBDDDNNNNNNNNNNNNNXXYYYYYYYYYYYYYAAIIIIIIIUUUUUIIIOOOOOIJJJJJUUUUUUUPNPUURRAAADDDDDDDDDDDDFCCCCXXXXXPPPPUUUUUUUGGGGGGG
FFFFFFFFFFFZZZZZFZFFFFDDDDDNNNTNNNNNNXXKXXYYYYYYYYYYYYYAIIIIIIIIUUIUUIIIOOOOOIIIJJJUUUUUUUUUPUURRAAAADDDDDDDDDDDCCCCCCXXXXPPPPGBBUUUUGGGGGGG
FFFFFFFFFFFFFZZZFFFFFFDDDDDNTTTNNNNCCXXXXXXXXMYYYYYYYYYCCIIIIIIIIIIIUIIIIIIIIIIIJTUUUUUUUUUUUUUAAAAAYYDDDDDDDDDDDDCCCEXXYXEPPGGBBUUUUGGGGGGG
FFFFFFFFFFFFFFZFFFFFFFFDTWTTTTTTNNNCCXXXXXXXXXYYYYYYYYYCCIIIQQIIIIIIUUUIIIIHHHHHHIBBUUUUUUUUUUAAAAAADDDDDDDDYEEEEECCCEXBEEEPPPGGGGGGGGGGGGGG
FFFFFFFFFFFFFFZFFFFFFFTLTTTTTTTTNNLXXXXXXXXXXXYYYYYYYYYIIIIIIIJIIICUUHHHHIIHHHHHHIIBUUUUUUUUUUAAAAAAAAAADDDDYEEEEEEEEEEEEEEEEPGGGGGGGGGGGGGG
FPFFFFFFVVFFFFFFFFFTTTTTTTTTTTTNNNXXXXXXXXXXXXXXSSSSCCWWWIIIIWWWWIIKIHHHHHHHHHHHHLLUUUUUUUUIIAAAAAAAAAADDDDDYEEEEEEEEEEEEEEEPPGGGGGGGGGGGGGG
PPPFFFFFVFFFFFFFFFTTTTTTTTTTTTTNNNNXXXXXXXXXXXXXUUUSCUUWWWWWWWWWWIIKKHHHHHHHHHHHHRRMMUUUYUUIIIAAAAAAAAAAAAAAYYEEEEEEGEEEEEEXGGGGGGGGGGGGGGGG
PPPFFFFFFFFFFFFFFFTTTTTTTTTTTTTTNNNXXXXXXXXXKKKKUUUUUUUUWWWWWWWWWWTTTHHHHHHHHHHHHRRRRRUUURUUUIAAAVAAAAAAAAAYYEEEEEEEGGEERRRRCCGGGGGGGGGGGGGG
PPPPPPPFVVFFFFFFFFFFYTTZTTTTTTGTNNXXXXXXXXXXKKKUUUUUUUUUUWWWWWWWHHHHHHHHHHHHHHHHHRRRRRRRRRERIIIAZVAAAAAAAAAYYEEEEEEEGGGRRRRRCEEEEGGGGGGGGGGG
PPPPPPPFVVFFFFFFFFFFTTTTTTTTTTGGGGXXXXXXXXXKUUKUUUUUUUUUUUUWWWWWHHHHHHHHHHHHHHHHHRRRRRRRRRRRRRRRRVVVAAAAAAYYEEEEEEEGGGGRRRRRCEEEEEGGGGGGGGGX
PPPPPPPFVVFFFFFFFFFFAATTTTTTTAGGGGGEXXXXXXKKKUUUUUUUUUUUUUUUWWWWHHHHHHHHHHHHHHHHHRRRRRRRRRRRRRRRRVAAAAAAAAAAJJEEEEEEGGGRRRRRRTEEEEEELLLGGGXX
PPPPPPPPPVVVFFFFFFFFATTTTTTTTTGGGGGEEXXXXXKKKUUUUUUUUUUUUUUWWWIIHHHHHHHHHHHHKKKKKRRRRRRRRRRRRRRRRAAAAAAAAAAJJEEEEEEEGGGRRRRRRTEEEEEIQLXXGGXX
PPPPPPPPPVVFFFFFFFFFFLLTTSSGGGGGGGGGEXXXKKKKKKKUUUUUUUUUUUUWWWIIHHHHHHHHHHHHKKKKKKKRRRRRRRRRRRRRRABAAAAAAAJJJEEEEERRGGGRRRRRRRRQQQQQQLXXXXXX
PPPPPPPPPPPFFOFFFJJFLLLTTGGGGGGGGGGEEEEEEEKEEEEUUUUUUUUUUUUWWWIIHHHHHHHHHHHHKLLLKKKKMMMRRRRRRRRRRRRTAAAAGAJGJGGERRRRGRRRRRRRRQQQQQQQQLLXXXXX
PPSPPPPWAPPOOOFJJJLLLLLGGGGGGGGGGGGGEEEEEEEEEEEEUUUUUUUUUUUWWWWIHHHHHHHHHSSKSLLLLKKMMMMMRRRRRRRRFRTTTAAAGGGGGGGERRRRRRRRRRRRRRRQQQQQQQXXXXXX
PPSSSPPWWPOOOOOOOOOLLLLLLLGGGGGGGGGEEEEEEEEEEEEEUUUUUUUOUUUWQWUIHHHHHHHHHSSSSLLLKKKMMMMMMRRMMRRRRRTTTTTTTGGGGGGGGRRRRRRRRRRRRQQQQQQQQQXXXXXX
SSSWWWWWVPOOOOOOOOOLLLLLLLGEEEGGGGGEEEEEEEEEEEEEEUUUUUUOJJJJUUUUHHHHHHHHHSSSSSLLLLLMMMMMMMMMMMRJTTTJJTTTTTTGGGGGGGRRRRRRRRRRRQQQQQQQQWXXXXXX
SWWWWWWWWCOOOOOOOOOLLLLLLLLEEGGGGGEEEEEEEEEEEEEEEUUUUUOOOJJJUUUUHHHHHHHHHHHHSSLLLLLMMMMMMMMMHHJJJJJJJJJJTTGGGGGGGGRRRYRRRRRRRQQQQQQQQXXXXXXX
SSWWWWWWWWOOOOOOOOOLLLLLLLLELEGGGGEEEEELEEEEHEEHSSOUOUOOOOJJJUUUUSSHHHHHHHHHSSSSSSGGGMMMMMHHHCCJJJJJJJJTTTGGGGGGGGRRYYYRRQQQQQQQQQQQQQSSSXXX
OWWOOWWWOOOOOOOOOOLLLLLLLLLLLEEEEEEELLLLEEEEHHHHHHOOOOOOOOJJUUUUUUUHHHHHHHHHSSSSSSSGMMMMHHHHHAJJJJJJJJJJTTGGGGGGGGRPYYRRRQRQRRQQQQQQQQQSSXBX
OOOOOOOOOOOOOOOOOOOLLLLLLLLLLEEEEEEELLLLEEEEHHHMMMMOOOOOOOOJJUUUUUUUHHHHHHHHSSSSSAGGHHHHHHHHHAAJJJJJJJJJJTTGGGGGYGYYYYYRRRRRRQQQQQQQQIBSBBBB
OOOOOOOOOOOOOOOOOOOLLLLLFFFLLEEEEELLLLLLHEEHHHHMMMMOOOOOOOOJJUUUUUUUHHHHHHHHSSSSAAGGGHHHHHHHHHAJJJJJJJJTTTTGGGGGYYYYYYYYRRRRRRRZZZZZBIBBBBBB
OOOOOOOOOOOOOOOOROOLLLLLLLFVFEEEELLLLLLLHHHHHHHHMMOOOOOOOOOJJPPPPSSSHHHHHHHHSSSAAAGGHHHHHHHHHAAJJJJJJJJTTTTTTGTTTTYYYYYYYRRRRRRRZZZBBBBBBBBB
OOOOOHHHHOOOOOORRRRLLLLLLFFFFEEEELLLLLLHHHHHHHHHHMMMOOOOOOJJJPPPPJSSHHHHHHHHSSAAAAAGHHHHHHHHAAAJJJJJJJTTTTTTTTTTTTYYYYYYYRRRRRRRBZZBBBBBBBBB
OOOOHHHHHOOOOORRRRRRRLLLLYFFFFLLLLLLLLLHHHHHHHHHHMMOOOOOOJJJJPJPJJSSHHHHHHHHSAAAAAAAHAHHHHHHAAAAJJJJTTTTTTTTTTTYYYYYYYYYYRRRRRRRBBBBBBBBBBBB
OOOOHHHHOOOOOOORRRRLLLLLYYFFFFFLLLLLLFFHHHHHHHHHHHOOOOOOOJJJJJJJJJJJHHHHHHHHSSAVAAAAAAAAHHHHHAAAJJJTTTTTTTTTTYYYYYYYYYYYYYRRRRRRDDFBBBBBBBBB
OOOOOOHOOOOOOORRRRRLLHLLYYFFFFFFLLLLFFFFFHHHHHHHHHJJOOOOOJJJJJJJJJJJJPPSSPPPSVAVVAAAUAUAHHHHAAAAAJJAATTAAAAATYYYYYYYYYYYYYVRRZZZDDDBUBBBBBBB
OOOOOOOOOOOOOOOORRRLLHHHHFFFFFFFFLFFFFFFFHHHHHHHHJJJJOOOJJJJJJVJJJJJJPPPPPPPVVVVVVUUUAUAAAAAAAAAAAAAATAAAAAAAOYYYYYYYYYYTYVRZZZZDDDBBBBBBBBB
OOOOOOOOKKOOOORRRRRRLHHHHFFFFFFFFFFFFFFFFHHHHHHHHJJJJJOJJJJVVVVVJOOJPPMPPPPVVVVVEUUUUUUUAAAAAAAAAAAAAAAAAAAAAUUUUYYYYYYYYYYYZZZZZZZZBBBBBBBJ
OOOOUUOOKKOOOOKRRRRBHHHHHFFFFFFFFFFFFFFFHHHHHHHHHHSSJJJJJPPPPPPQOOOJPPPPPPPYYVVVUUUUUUUUAAAAAAAAAAAAAAAAAAAAAAUUYYYYYYYYYYYZZZZZZCCZZBBBBBBJ
OOOUUUUKKKKKKKKRRRRHHHHVHHRFFFFFFFFFCFHHHHHHHHHHHHSSSJJJPPPPPPQQQOOOPPPPPPPPPOVKUUUUUUUUUUAAAAAAAAAAAAAAAAAAAUUUYYYYYYYYYYLEEEZZCCCCCCBBOBVJ
POOUUUUKKKKKKKGGRRSSHHVVVRRRFFFFFFFCCCCCHHHCHHHHHHRSSJJJPPPFPPQQVOOOOOPPPPOPOOUUUUUUUUUUUAAAAAAAAAAAAAAAAAAAAAUUYYYYYYYYYLLEEELZCCCCCCXBOVVJ
POUUUUUKKKKKKKSSRRRSHHRRRRRRRRFFFFCCCCCCCHHCHHHHHHSSSSSPPPPPPPPQVOKKKOOOOOOOOOUUUUUUUUUUAAAAAAAAAAAAAAAAAAAAAUUUYYYYYYYYYRRRRRRRRRRCCCCCOVVJ
POUUUUUUKKJJYYYSRSSSHRRRRRRRRRRCFCCICCCCCCCCHHHHEEEEEEEPPPPPPPPQVVVKKKOOOOOOOOOUUUUUUUUUAAAAAAAAAAAAAAAAAAAAAAUUUYYYYYYYYRRRRRRRRRRCCCCCCVVV
PPUUUUUUJJJJJJSSSSSBBIRRRRRRRRRCFCCCCCCCCCCCCCEEEEEEEEEPPPPPPPPQVVVKKOOOOOOOOOTPPUUUUUAAAAAAAAAAAAAAAAAAAAAAUUUUUUYYUUYYYRRRRRRRRRRCCCCCVVVD
UUUUUUJUJJJJHJSSSSSBBRRRRRRRRRRCCCCCCCCCCCCCCCEEEEEEEEEPPPPPPPPQVVHKKKOOOOOOOOTPPPUUUUAUAAAAAAAAAEAAAAANGAAAUUUUUUUYUULYLRRRRRRRRRRVVVVVVVVD
JUUUJJJJJJJJJESSSBBBBRRRRRRRRRRCPCCCCCCCCCCCCCEEEEEEEEEPPPPPPPPPPPKKKKKOOOOOOTTPPUUUUUUUUUAAAAAAAEEEAANNNNNUUUUUUUUUUULLLRRRRRRRRRRVVVVVVVVD
JJUJJJJJJJJJJSSSSVBBBRRRRRRRRRRRPCRCCCCCGCCCCCEEEEEESPPPPPPPPPPPPPKKKKKKKOOOOTTPPPUUUUUUUUAAEEEEEEEEANNNNNNUUUUUUUUUUUUULRRRRRRRRRRVVVVVVVVV
JJJJJJJJJJJJUUUBBBBBBCCCCRRRRRRRKRRRRRRRCCCCCCEEEEEESPPPPGPPPPGPKKKKKKKJKTTTTTTTTUUUUUHUUUUUUEEEEEEENNNUUUUUUUUUUUUUUULULRRRRRRRRRRVVVVVVVVV
JJJJJJJZZZJUUUUUUCBBCCCCCCCRRRUKKKKRRRRCCCCCCCEEEEEEGGGPGGPGGPGGKKKKKKKKKTTTTTTTTTUUHHHHUUUUUEEEEEEENNNNNNNUUUUUUUUURRRRRRRRRRRRRRRVVVVVVVVV
JJJJJJZZZZZUZUCCCCBBCCCCCCCCGGKKKKRRRRRCCCCCCCEEEEEEGGGGGGGGGGGGKKKKKTTTTTTTTTTTTTTUHHHHHHHHULEEEEEEGNUGGNNNNUUUUUUURRRRRRRLLLUUUUSVVVVVVVVV
JJJZJJZZZZZZZUZJCCCCCCCCCCCCCCOKKKRRRRRRCCCCCCEEEEEEGGGGGGGGGGGGGKKKKKITTTTTTTTTTTUUHHHHUUUUULEEEEEGGCGGNNNNUUZZUUUJRRRRRRRUUUUUUUUUVVVVVVVV
JJJZZZZZZZZZZZZJCCCCCCCCCCCCOOOKKKRRRRCCCCCCCCEEEEEEGGGGGGGGGGGGGGGGIIITTTTTTTTTTTTHHHUHHUUUUUEEEEEGGGGGGGGGGGGZZZUJRRRRRRRUUUUUUUUUUUUUUVVV
JZZZZZZZZZZZZZZZZCCCCCCCCCCOOKKKKKRRRCCCCCCCCCCCCPGGGGGGGGGGGGGGGGIIIZZZATTTTTTTTTHHHHUUUUUUUUAAAEEGGGGGGGGGGGGGGGLLRRRRRRRUPUUUUUUUUUUUUUVV
JZZZZZZZZZZZZZZZCCCRRCRRCCCCOORKRKRRRRCCCCCCCCCCCGGGGGGGGGGGGGGGGGGIIZZZAZTTTTTTTTTHHUUUUUUUUUUAUGGGGGGGGGGGGGGGGGGLLLLLLLLLLPPUUUUUUUUUUUVV
JZZZZZZZZZZZZZZOOCCRRRRRCCCCVORRRRRRRRRRCCCCCCCCCCGGGGGGGGGGGGGGIGIIIZZZZZTTTTTTTTTHHHUUUUUUUUUUUGGGGGGGGGGGUGGGGGGLGLLLLLLLUUUUUUUUUUUUUUVV
JJZZZZZZZZZZZZZOOOCRRRRRRCCRVVVRRRRRRRRCCLLCCCCCCGGUUUUGGGGGGGGGIGIIIZZZZTTTTTTTTTTHHHUUUUUUUUUUUGGGGGGGGGGGGMMGMMGGGLLLLLLLAUUUUUUUUUUUUUVV
JJZZZZZZZZZZZZZORRRRRRRRRRCRVVVRRRRVVRDLLLDDFCCCCUUUUUUUGGGGGGGGIIIIIZZZZTTTTTTTTTHHWWXWWWUUUUUDUDGGGGGGGGGGMFMMMMGGGGLLLLLAAAAUUUUUUUUUUVVV
JJZZZZZZZZZZZZZQQERRRRRRRRRRVVVVVVVVDDDDDDDDFFFYUUUYUUUUGGGGSSGIIIIIIIZIJTTTTTTTTTTHWWWWWWUUUUUDDDDGGGGGGGGGMMMMMMMMGGLLLLLAAAAUUUUUUUVUUUVV
JJJJZZZZZZZZZZQQRRRRRRRRRRRRRVVVVVVVVDDDDDDFFFFYYUYYYUGGGIIGSEGEEIIIIIIIJJJTTTTTTWHHWWWWWWWWWUDDDDDGGGGGGGGGPMMMMMXMMMLLLLAAAAAAUUUUUUVVVVVV
JJJJJZZZZZZZZZQQRRRRRRRRRRRRRVRRRVVVDDDDDDDDFYYYYYYYYYXXGGGGEEEEEIIIIIIJJJJJJTTTTWWWWWWWWWWWWDDGDGDGGGGYGGGGPMMMMMMMMALLAAAAAAAAUUUUVVVVVVVV
JJJJZZZZZZVQZQQRRRRRRRRRRRRRRRRRRRRDDDDDDDDDDYYYYYYYYYXXXXXEEEEEEIIEIIIJJJJJJTTTWWWWWWWWWWKKWDDGGGGGGGGVVGGGMMTMMMAMAAALAAAVAAAVXXUUUVVVVVVV
JJJJZZZZZQQQQQQRRRRRRRRRRRRRRXXRRRRRDDDDDDDDDYYYYYYYYYYXXXXXXEEEEEEEIIJJJJJJJJTTJJWWWWWWWMMMWDGGGGGGGGXVVGGGBMTMMMAAAALLAAAVVAVVXUUUVVVVVJVV
JJJJZZZULQQQQQQRRRRRRRRRRRRRRRRRRRRDDDDDDDDDDYYYYYYYYYYYXXXXXXEEEEEEJIJJJJJJJJJOXXWWWWWWWMMMDDGGGGGGGGVVVGVVMMMMMMAAAAAAAAVVVVVXXXXXVVVVJJVV
JJJUUZZULLQQQQQRRRRRRRRRRRRRRRRRRRRRRRDDDDDGYYYYYYYYYYYYXZZXXXEEEEEEJJJJJJJJJJJXXXZWWWFFFMCMDDDDGGGGGGVVVVVMMMMMMMMAAAAAAAVVVVVXXVXVVVVJJJVV
JJJUUUUUUQQQQQQRRRRRRRRRRRRRRRRRRRRRRRRDDDDDRYYYYYYYYYZYXZZXXXEEEEEEJJJJJJJJJJJXXXXFFFFFFDDMDDDDDGGGGGVVVVVAMMMMAAAAAAAVAVVVVVVVXVVVVVJJJJJV
JUUUUUUUUUQQQQQRRRRRRRRRRRRRRRRRRRRRRRRRDDDHRYYYYYYYYYZXXXZZXXEEEEEEJJJJJJJJJJJJXXXXXXXXDDDDDDDDDGGGGGGVVVVAAAMAAADAAAAVVVVVVVVYVVVVRJJJJJJV
JUUUUUUUUUQCQQQQRRRRNNRNRRRRRRRRRRRRRRRRRRRRRRYYYYYYYYZZXZCZZEEEEEEEEEJJJJJJJJJJXXXXXXDDDDDDDDDGGGGGGGGGVAAAAAAAADDDDDDVVKVVVVVYVQQJJJJJJJJJ
JJUUUUUUUUCCCCCVRRRRNNNNNRRRRRRRRRRRRRRRRRRRRRRYYYYYZZZZZZZZZZZEEEEEEEEJJJJJJJJJJXXXXXDDDDDDDDDGGGGGGGGAAAAAAAAAADDDDDDVVVVVVVYYVQQJVJJJJJJJ
JVUUUUUUUCCCCCCVVVNNNNNYYQYYRRRRRRRRRRRRRRRRRRRYYWWYYYYZZZZZZZZEEEEEEEEJJJJJJJJJJXXXDDDRRDDDDDDGGGGGGGGGAAAAAAAAADDDDPWVPPPPVVYVVJJJJJJJJJJJ
VVUUUUUUUVVCCCVVVVNNNNYYYYYYRRRRRRRRRRRRRRRRRRRYWWWYYYYZZZZZZZYEEEEEEEEEKJJJJJJYJJXRRRRRDDDDDDDGGWWWGTIIAAAAAAAAADDPPPPPPPPPPVPRJJJJJJJJJJJJ
VVUUUUUUUUVVVVVVVVVVYNYYYYYYRRRRRRRRRRRRRRRORZZYWWWYYYYYZZZZZZZLZZZEEEEEKKKJJJYYYYYYYRRDDDDDDDDWWWWGGTIAAAAAAAAADDDPPPPPPPPPPPPJJYJJJJJJJJJJ
VVVVUUUUUVVVVVVVVVVYYYYYYYYYYRRMRRRRMMMRRRROOWZZWWWYYYYYZZZZZZZZZSSEEEEEEKKGGJYYYYYYYRBBDDDDWWWWWWWWTTIITAAAALAKDDDDPPPPPPPPPPPJJJJJJJJJJJJJ
VVVVVVUUUUVVVVVVVVVDYYYYYYYYYRMMMMRRMMRRRFWWWWWWWWWWWYYZZZZZZZZSSSSSEEKEEKKGGYYYYYYYJBBJDDDDWWWWWWWWTTTTTAAAALADDDDDPPPPPPPPPPPPPJJJJJJJJJJJ
VVVVUUUUUVVVVVVVVVVVYYYYYYYYYMMMMRRMMMMRRWWWWWWWWWWWWYWGZZZZZZQSSSSSSSKKKKKGGGYYYYYYJJJJEDDDDWWWWWWWTTTTLAALLLLXXXXXXXKXPPPPPPPPPJJJJJJJJJJJ
VVVNNNUNVVVVVVVVVVBBYYYYYYYYMMMMMMMMMMHHYWWWWWWWWWWWWWWWWWZZZZZSSSSSSSKKKKKKGGYYYYYYJJJJEDDDDWWWWWWWWLLLLLLLLLLXXXXXXXXXPPPPPPPPPFJJJJJJJJJJ
VVVNNNNNVVVVDUCVVVBBYYYYYYYOOMMMMMHMMMHHHHWWWWWWWWWWWWWCCZZZZZSSSSSSSKKKKKKKKKKKKYYYJJJJEEXXDWWWWWWLLLLLLLLLLXXXXXXXXXXXXXPPPPPPPFFFFJJFFFJJ
VVVVVNNNNVVJUUUUULUUYKYYYYOOOMMMHMHMMMHHHHWWWWWWZWWWWWWCCCCZZSSSSSSSZSYKKKKKKKKYYYYJJJJJJXXXXXXWWWWLLLLLLLLLLXXXXXXXXXXXZZZZPPPPFFFFFJFFFFJJ
RRRNNNNNNJJJUUUUUUUUUOOOYYOOOOMMHHHMMMHHHHHAWWWWZZZWWWCCCCVSSSSSSSSSSSSCKKKKKKKYYJYJJJJJXXXXXHHXXWWLLLLLLLLLLXXXXXXXXXXZZZZZZZZZZFFFFFFFFFJJ
RRRNNNNNNJJJUUUUUUUUUUOOOOOOOMMMHHHHHMMHHHAAAWWZZZZZWWCCCCVVSSSSSSSSSSSCCCKKKYYYYJJJJJJJJXXXXXXXZZZZLLLLLLLLLXXXXXXXXXXZZZZZZZZZZFFFFFFFFFFF
RRNNNNNNNNNUUUUUUUUUUUOOOOOOYHMHHHHHHHMMMMOAUWWWUUUUUUUUUURVSSSSSSSSSSCCCCCQYYYYYJJJJJJJJXXXXXXXXZZLLLLLLLLLLLXXXXXXXXXZZZZZZZZFFFFFFFFFFFFF
RRNNNNNNNNUUUUUUUUXXUOOOOOOOHHHHHHHHHHHHMOOAUUUUUUUUUUUUUUVVVSSSSSSSSCCCCCQQYYYYJJJJJJJJJXXXXXXXZZZZZYHLLLLLLLLXXXXXBBBBBBZZZZFFFFFFFFFFFFFF
NNNNNNNNNUUQUUUUUUXOUOOOOOOHHHHHHHHHHHHHOOOOOOUUUUUUUUUUVVVVVVSSSSSSSCCQQQQQQQJJJJJJJJJXJXXXXXXZZYZYYYYJJJJLLLLLXXXXXBBBBBBZBBFFFFFFFFFFFFFF
NNNNNNNNNUUUUBBBUUUOOOOOOOOOHHHHHHHHHHOOOOOOOOUUUUUUUUUUVVVVVVVVVCSSCCQQQQQQQQQJJJJJJXXXXXXXXXXYYYYYYYYJJJJLLLLLLLXBBBBBBBBBBBFFFFFFFFFFFFFF
WNNNNNNNNNUBBBBBUUYOOOOOOHHHHHHHHHHHOZOOOOOOOOUUUUUUUUUUVVVVVVVCCCOSCQQQQQQQQFFVVJJJJXXXXXXXXXXYYYYYYYJJJJJJLLLLJXXXXXBBBBBBBBBFFFFFFFFFFFFF
WNNNNNNBNBBBBBBBUUOOOOOOOOHHHHHHHHHHOOOOOOOOOOUUUUUUVVVVVVVVQVVCCCSSQQQQQQQQFFFVVJJJJNNNXXXXXXXYYYYYYYYJJJRJJXLLLXXXXXBBBBBBBBFFFFQQQFFFFFFF
WWNNNNBBBBBBBBBBBBBBOPOOOOOHHHHHHHHHHOOOOOOOOOUUUUUUUVVVVVVVQQQQCCSSXQQQQQQMFFFFFJBNNNNNXXXXXXYYYYYYYXXXJJJJXXLLXXXXXXXIBBBBBBFFFFQQQFFFFFFF
TTNNWWWBBBBBBBBBBBBBBBQOOHHHHKHHHHHHHZOOOOOOOOOOUUUUUVVVVVQQQQQQQQQQQQQQQQQFFFFFBBBNONNNXXXXXYYYYYYYYNNXXXXXXXXXXXXXXXIIBIIIIBBFFFQQQFFFFFFF
TTTTTWWBBBBBBBBBBBBBBKQOOHHHHHHHHHHHZZOOOOOOOOOOUUUUUVVVVQQQQQQQQQNQQQQQQQFFFFFFBBBOONNNXXXXXXXYYYYYNNNNXNNNNNXXXXXGXXIIIIIIIBBFFFQQQFMMFFFF
TTTTTWWBBCBCBBBBBBBBBQQQHHOOHHHHHHHHZZZOZOOOOOOOUUUUVVVVVVQQQQQQQQQQQQQQFFFFFFFFFBBOOOONXAXAXXYYYYYYYYNNNNNNNNNXXXXGGGBIIIIIIIBFFFQQQMMFFFQF
TTTTTTWWWCCCBBBCCBQBQQQQQQOHTHHHHHHHZZZZZOOOOOOOUUVVVVVVVVQQQQQQQQQQQQQFFFFFFFFFBBBOOOOOAAAAYYYYYYYYYNNNNNNNNNNXXXBGBBBBIIIIIIBFQQQQQQQQFQQQ
TTTTTTTWCCCCBCCCCQQBUQQQQQOHHHHHHHHHZZZZZZZZOOOOUVVVVVVVVQQQQQQQQQQNNQQZZZFFFFFFOOOOOOOWWWWAWYYYYYYYYYNNNNNNNNXXXBBBBIIBXIIIIIIZQQQQQQQQFQPP
TTTTTTJCCCCCCCCCCQQQQQQQQQQPHHHHHZZZZZZZZZZZZOSVVVVVVVVVVQQQQQQQQQQQNQQZZZZZZFFFOOOOOWWWWWWWWYLLYYYYYKNNNNSNNNXXXXXBBBIIIIQQQQQQQQQQQQQQMQQP
TTTTTTTCCYYYYYYCQQQQQQQQQQQPZHHZZZZZZZZZZZPZZOPVVVVVVVVVVVQQQQQQQQQQQQQZZZZZZFFFOOOOOWWWWWWWIHLYYKKYKKKNNNWWNNNNXXXXBBDIZZQQQQQQQQQQQQQQQQQQ
TTTTTTTCCYYYYYYCQQQQQQQQQQKZZZZZZZZZZZZZZPPPPPPPPVVVVVVVVVQQQQQQQQQQQZZZZZZZZZFWOWOWWWWWWWWWWHHJHKKKKKKKNNWWNXXXXXXXBZDIZZQQQQQQQQQQQQQQQQQQ
TTTTTTXXYYYYYYYCCQQQQQQQKQZZZZZZZZZZZZZPPPPPPPPPVVVVVVVVVQQQQQQQQQQQZZZZZZZZZZFWWWOWWWWWWWWWWHHHHHHHHHHWWWWYNXXXXXXXXZZZZZXZZZZQQQQQQQQQQQQG
TTTTTXXXYYYYYYYCCQQQQQQQKZZZZZZZZZZZZZZPPPPPPPPPPPVVVVVVVQVQAQQQBQQQZZZZZZZZZZZWWWWWWWWWWWWWLHHHHHHHHWWWWWWWWWXWXXXXXXXZXXXXZZZQQQQQQQQQQQGG
THTTXXXXYYYYYYYCQQQQQQQQWWZDZZZZZZZZZZZZPPPPPPPPPPPVVVVVVVVVQQQQQQQZZZZZZZZZZZWWWNWWWWWWWWWHHHHHHHHHHHHWWWWWWWWWXXXXXXXXXEEXZZQQQQQQQQQQQQGG
TTXXXXXXYYYYYYYQQQQQQQZQWWDDZZZZZHZZZZPZPPPPPPPPPPPVPPVVVVVQQQQQQUUZZZZZZZZNNNNNNNWWWWWWWWWHWHHHHHHHHHHWWWWWWWWWWXXXXXXXEEEZZZQQQQQQQQQQGGGG
XXXXXXXXYYYYYYYTQQQQQQWWWWWDDZZZHHHZZZPPPPPPPPPPPPPPPCDVDVVQQQQQQQZZZZZZZNMNNNNNNWWWWWWWWWWWWWBHHHHHHHHWWWWWWWWWWXXXXEEEEEEEMMQQQQQQQQQQGGGG
XXXXXXXXXXXXXXTTTQQTQEWWWWWWWIHIHHHHZZZPMPPQPPPPPPPPPCDVDDDQQQQBQQZZZZZZNNNNNNNNNNNNWWWWWEEWWRBHHHBBHWWWWWWWWWWWWWXXEEEEEEEEEEQQQQQGGGGGGGGG
LXLLLLXXXXXXTTTTTTTTWWWWWWWWWWHHHHHHZHHQMQQQQPPPPPPPCCDDDDDOOQBBBQQZZZZZNNNNNNNNNNNNWWWWEEEEERBHBBBBBBWWWWWWWWWWWWXXXEEEEEEEEEQQQGGGGGGGGGGG
LLLLLLXXXXXXTTTTTTTUWWWWWWWWHHHHHHHHHHHQQQQQQQPPPCPCCCCDDDDDDDBBBBZZZZZNNNNNNNNNNNNWWWWWEEEEEEBBBBBBBBWWWWWWWWWWWXXXXEEEEEEEEEQQQGGGGGGGGGGG
LLLLLLXXXXTXUUTTUUUUWWWWWWWWHHHHHHHHHHHQQQQQQQPPPCCCCCCDDDDDDDDBBBZIZHZNNNNNNNNNNNWWWWWWEEEEEABBBBBBBBWWWWWWWWWWWWXEEEEEEEEEEEQQQGGGGGGGGGGG
LLLLLLXBTTTUUUUUUUUUWWWWWWWHHHHHHHHHHHHHQQQQTTPPPCCCCCDDDDDDDDABBBBZIZZNNNNNNNNNNNWWWWWWEEEEEBBBBBBBBBBWWWBWWWWWWWWNEEEEEEEEEEQQQGGGGGGGGGGG
LLLLLLLBTTTUUUUUUUUUWWWWWWWWHHHHHHHHHHHHQQQQQQPPCCCCCDDDDDDDDDDBBBBZZZZNNNNNNNNNNNWWWWWWWVEEBBBBBBBBBBBBWBBBWWWWWWWOOEEEEEEEEEELLGGGGGGGGGGG
LLLLMMBBUUUUUUUUUUUWWWWWWWWWWHHHHHHHHHHHBQQQQBBBBBCCCCDDDDDDDDDDBBBZBBBNNNNNNNNNNNNOOWWVVVBBBBBBBBBBBBBBBBGOWWWWFOOOOEEEEEEEEEEEEAAGGGGGGGGG
LLLMMMABUUUUUUUUUUUUWWWWWWKKWHHHHHHHHHHHBQQBBBBBCCCCCDDDDDDDDDDBBBBZBBBBBBBBNNNNNOOOOWWWVBBBBBBBBBBBBBBBIIOOOWWWOOOOOOVEEEEEEAEEAAAGGGGGGGGG
LLLMMMAAAUUUUUUUUUUWWWWWWWKKWXHHHHHHHHHBBBBBBBBBCCCCCCCCDDDDDDDBBBBBBBBBBQBBOOONNOOOOWWWWBBBBBBBBBBBBBBIIIOOOWWWWOOOOOOUEEEEAAAEAAAAASSGGGAA
LLMMMAAAUUUUUUUUUUUWWWWWWWKGHHHHHHCCHBBBBBBBBBBBBCCCCCDDDDDDDUDBBBBBBBBBBBBBOOOOOOOOOWUUYBYBBBBBBBBBBBBIVVVVOOOWOOOOOOOUEAAAAAAAAAAAAASSGGAA
LQQQQQAAAUUUUUUUUUUUUUWWKKKKHKKHHHCCBBBBBBBBBBBBBBCCCCDDDDDDDDBBBBBBBBBBBBOOOOOOOOXXOWUUYYYBBBBBBBBBBBAVVVVVOOOOOOOOOOOOOOXXXXAXXAAAAASSSAAA
QQQQAQQAAAUATTTUUUUUUUUUPKKKKKKKHHCKBBBBBBBBBBBBBBBBCCDDDOKKKDBBBBBBBBBBBOOOOOOOOXXXXGUUYYBBBBBBBBBBBAAAAVVVVVOOOOOOOOOOOXXXXXXXAAXAAAAAAAAA
QQQQQQAAAAAATTTTTTTTTHXXXKKKKKKKHRKKBBBBBBBBBBBBBBBCCDDDOOKKKKBBBBBBBBBBBBBOOOXXXXXUUUUUUUBBBBBBBBZBHZAAAAAVVVOOOOOOOOOXXXXXXXXXXAXAAAAAAAAA
QQQQQQAAAAATTTTTTTTTTXXKKKKKKKKKHKKKEEBBBBBBBBBBBBBBBDDDOOKKKKKBXBBBXXBBBBOOOOOXXXXXUUUUUUBBLLLBZZZPZZZAAAAVVVVOOOOOOOOOXXXXXXXXXAXXXAAAAAAA
QQQQQQQAATTTTTTTTTTTTXXXKKXXXKKKKKKKEBBBBBBBBBBBBBBDDNDSDOOOOKKXXXXXXXXVBBOVVVVVVXXXXUUUUUBLLLLZZZZZZZZAAAAAVCVPOOOOOOOXXXXXXXXXXXXXXAAAAAAA
QQQQQQQAAATTTTTTTTXLXXXXXKXXXKKKKKEEEFFBBBBBBBBBBBBDDDDDDOOODKKXXXXXXXXVVVVVVVVVVXXXUUUUUUUZLZZZZZZZZZZZZZAAVPPPPOOOOOGGGXXXXXXXXXXAAAAAWAAA
QQQQQQQAATTTTTTTTXXXXXXXXXXXXKKKKKEEEEEEBBBDBBBBBDDDDDDDDDDDDKKXXXXXXXXVVVVVVVVVVVVXXUUUUUUZZZZZZZZZZZZZZZAAPPPPPOOOOEGGGXXXXXXXXXXXAAAAAAAA
QQQQQQQQQTTTTTTXXXXXXXXXXXXXXXKKEEEEEEEEBBBDDBBMMDDDDDDDDDDDDDKKXXXXXXXVVVVVVVVVVVVXXURUUUUZZZZZZZZZZZZZZZZZPPPPOOOOEEGGGGXXXXXXXXXXAAAAAAAA
QQQQQQQQQQMTTTTXXXXXXXXXXXXXXKKEEEEEEEEEEBBBBBMMMDDDDDDDDDDDDDXXGXXXXXXXVVVVVVVVVVVXXUUUUUUUXXZZZZZZZZZZZZPPPPPPPOOOEEGGGGGXXXXXAHXKAAAAAAAA
QQQQQQQQQQTTTTTXXXXXXXXXXXXXXXXEEEEEEEEEEEBEEBMDMDDDDDDDDDDDDIXXXXXXXZZZVVVVVVVVVVVXXUHUUUUUXXZZZZZZZZZZIZPPPPPPYYOYEEEGGGGGGGXXAHXXAAAAAAAA
QQQQQQQQQQQITTTXXXXXXXXXXXXXEEXEEEEEEEEEEEEEEEDDDDDDDDDDDDDDDIIXXXXXXXXXVVVVVVVVVVXXXUUUUUUUUXXZZZZZZZZZZZPPPPPPYYOYEEEEGGGGGAAAAAANAAAAAAAA
QQQQQQQQQIIITTTTXXXXXXXXXXXEEEEEEEEEEEEEEEEEEEEEDDDDDDDDDDDDDDDDXXXXXXXXXVVVVVVVVVXXXXXXXUXUXXXZZZZZZZZZZZZPPPPPYYYYEEEGGGGGGAAAAAAAAAAAAAAA
QQQQQQQQQIIIIIIIXXXXXXXXXXXXXEEEEEEEEEEEEEEEEEEDDDDDDDDDDDDDDDXXXXXXXXXXVVXVXVVXXVXXXXXXXXXXXXXZZZZZZZZZZZZPPPPPPPYEEEGGGGGGGGGAAAAAAAAAAAAA
QQQQQQQQIIIIIIIXXXXXXXXXXXXXXXEEEEEEEEEEEEEEEEEDDDDDDDDDDDDDDXXXXXXXXXXXXXXXXVXXXVVXXXXXXXXXXXXXZZZZZZZZZZAAPPAAAAEEEEEGGGGGGGGAAAAAAAAAAAAA
QQQQQQQQIIIIIIIXXHXAXXXXXXRXXEEEEEEEEEEEEEEEEEEDCDWDEEDDDDDDDDXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXZZZZZZZPZAAAAAAAAAAEEEGGGGGGGAAAAAAAAAAAAAAN";

var smallInput =
@"RRRRIICCFF
RRRRIICCCF
VVRRRCCFFF
VVRCCCJFFF
VVVVCJJCFE
VVIVCCJJEE
VVIIICJJEE
MIIIIIJJEE
MIIISIJEEE
MMMISSJEEE";

var smallest =
@"OOOOO
OXOWO
OOOOO
OZOYO
OOOOO";

var input = smallInput;
input = fullInput;
//input = smallest;
var timer = System.Diagnostics.Stopwatch.StartNew();

var result = 0l;

var directions = new[] { new[] { 0, 1 }, new[] { 0, -1 }, new[] { 1, 0 }, new[] { -1, 0 } };

var grid = input.Split(Environment.NewLine).Select(x => x.ToCharArray()).ToArray();
var plotGrid = grid.Select(x => x.Select(y => new Plot { Letter = y }).ToArray()).ToArray();
var height = grid.Length;
var width = grid[0].Length;


for (int y = 0; y < height; y++)
{
    for (int x = 0; x < width; x++)
    {
        var plot = plotGrid[x][y];
        foreach (var direction in directions)
        {
            var otherX = direction[0] + x;
            var otherY = direction[1] + y;
            if (otherX < 0 || otherY < 0 || otherX >= width || otherY >= height) { continue; }
            var otherPlot = plotGrid[otherX][otherY];
            plot.Neighbours.Add(otherPlot);
        }
    }
}

var allPlots = plotGrid.SelectMany(x => x);
while (true)
{
    var somePlot = allPlots.FirstOrDefault(x => !x.RegionId.HasValue);
    if (somePlot == null) { break; }
    var visited = new HashSet<Plot>(new[] { somePlot });
    //var ignored = somePlot.GetSimilarNeighbours(visited).ToList();
    somePlot.GetSimilarNeighbours(visited);

    var regionId = Guid.NewGuid();
    visited.ToList().ForEach(x => x.RegionId = regionId);
}

var perimeters = allPlots.Select(x => x.RegionId).Distinct().ToDictionary(x => x, x => 0);
var areas = allPlots.GroupBy(x => x.RegionId).ToDictionary(x => x.Key, x => x.Count());

for (int y = 0; y < height; y++)
{
    for (int x = 0; x < width; x++)
    {
        foreach (var direction in directions)
        {
            var value = plotGrid[x][y].RegionId;
            var otherX = direction[0] + x;
            var otherY = direction[1] + y;
            if (otherX < 0 || otherY < 0 || otherX >= width || otherY >= height)
            {
                perimeters[value]++;
                continue;
            }
            var otherValue = plotGrid[otherX][otherY].RegionId;
            if (value != otherValue)
            {
                perimeters[value]++;
            }
        }
    }
}

foreach (var regionId in allPlots.Select(x => x.RegionId).Distinct())
{
    result += perimeters[regionId] * areas[regionId];
}



timer.Stop();
Console.WriteLine(result);
Console.WriteLine(timer.ElapsedMilliseconds + "ms");
Console.ReadLine();

void PrintGrid<T>(T[][] grid)
{
    for (int i = 0; i < grid.Length; i++)
    {
        for (int j = 0; j < grid[i].Length; j++)
        {
            Console.Write(grid[i][j]);
        }
        Console.WriteLine();
    }
}

class Plot
{
    public char Letter { get; set; }
    public Guid? RegionId { get; set; }

    public List<Plot> Neighbours { get; set; } = new List<Plot>();

    public void GetSimilarNeighbours(HashSet<Plot> visited)
    {
        foreach (var item in Neighbours)
        {
            if (Letter == item.Letter && !visited.Contains(item))
            {
                //yield return item;
                visited.Add(item);
                item.GetSimilarNeighbours(visited);
                //foreach (var item2 in item.GetSimilarNeighbours(visited))
                //{
                //    //yield return item;
                //}
            }
        }
    }
}